<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=0.8">
<style>
body {
  height: 100%;
  overflow: hidden;
}
.top {
  padding: 2px;
  border: 3px solid #73AD21;
  background-color: white;
  height: 25px;
  margin-bottom: 2px;
}
.comment {
  padding: 2px;
  border: 3px solid black;
  background-color: white;
  height: 60px;
  margin-bottom: 2px;
  overflow: scroll;
}
.main {
  height: calc(100% - 90px);
  overflow: scroll;
}

pre {margin-left:1em;}
</style>
</head>
<body>
<div class="top">
<button id="step" onclick="forwards()">Step</button> <button id="back" onclick="backwards()">back</button>
</div>

<div class="comment">
<div id="co_start">startti</div>
<div id="co_s1" style="display:none">s1</div>
</div>

<div class="main">
<p>
<pre>
<!--
<span id="s1" style="display:none"><span style="color:#006600">
<span id="s1_route_1_1">&rArr;</span> route(<span id="s1_route_1_town1">Town1</span>, <span id="s1_route_1_town2">Town2</span>, <span id="s1_route_1_length">Length</span>) :- 
<span id="s1_route_1_2">&rArr;</span>    connected(<span id="s1_route_1_town1_0">Town1</span>, <span id="s1_route_1_townx">TownX</span>, <span id="s1_route_1_length1">Length1</span>), <span id="s1_route_1_2c">&rarr;</span> 
<span id="s1_route_1_3">&rArr;</span>    route(<span id="s1_route_1_townx_0">TownX</span>, <span id="s1_route_1_town2_0">Town2</span>, Length2), <span id="s1_route_1_3c">&rarr;</span>
<span id="s1_route_1_4">&rArr;</span>    <span id="s1_route_1_length_0">Length</span> = <span id="s1_route_1_length1_0">Length1</span> + Length2.
<hr></hr></span></span>
<span id="road_1">&rArr;</span> road(joensuu, kajaani, 230). <span id="road_1x"></span>% 230 km road connection from Joensuu to Kajaani
<span id="road_2">&rArr;</span> road(kajaani, oulu, 183). <span id="road_2x"></span>% 183 km road connection from Kajaani to Oulu

<span id="connected_1_1">&rArr;</span> connected(<span id="connected_1_town1">Town1</span>, <span id="connected_1_town2">Town2</span>, <span id="connected_1_length">Length</span>) :- 
<span id="connected_1_2">&rArr;</span>   road(<span id="connected_1_town1_0">Town1</span>, <span id="connected_1_town2_0">Town2</span>, <span id="connected_1_length_0">Length</span>). <span id="connected_1_2c">&rarr;</span><span id="connected_1_2x"></span>

<span id="connected_2_1">&rArr;</span> connected(<span id="connected_2_town1">Town1</span>, <span id="connected_2_town2">Town2</span>, <span id="connected_2_length">Length</span>) :- 
<span id="connected_2_2">&rArr;</span>   road(<span id="connected_2_town2_0">Town2</span>, <span id="connected_2_town1_0">Town1</span>, <span id="connected_2_length_0">Length</span>). <span id="connected_2_2c">&rarr;</span><span id="connected_2_2x"></span>

<span style="visibility:hidden">&rArr;</span> route(Town, Town, 0).

<span id="route_1_1">&rArr;</span> route(<span id="route_1_town1">Town1</span>, <span id="route_1_town2">Town2</span>, <span id="route_1_length">Length</span>) :- 
<span id="route_1_2">&rArr;</span>    connected(<span id="route_1_town1_0">Town1</span>, <span id="route_1_townx">TownX</span>, <span id="route_1_length1">Length1</span>), <span id="route_1_2c">&rarr;</span> 
<span id="route_1_3">&rArr;</span>    route(<span id="route_1_townx_0">TownX</span>, <span id="route_1_town2_0">Town2</span>, Length2), <span id="route_1_3c">&rarr;</span>
<span id="route_1_4">&rArr;</span>    <span id="route_1_length_0">Length</span> = <span id="route_1_length1_0">Length1</span> + Length2.
    
<span id="_1_1">&rArr;</span> :- route(oulu, joensuu, <span id="_1_len">Len</span>), <span id="_1_1c">&rarr;</span> 
<span id="_1_2">&rArr;</span>   write(Len, ' ').
-->
<span id="s1" style="display:none">
<span id="s1_goal_1">&rArr;</span> :- route(oulu, joensuu, [], <span id="s1_goal_route">Route&#x2081;, <span id="s1_goal_len">Len&#x2081;</span>), <span id="s1_goal_1c">&rarr;</span>   
<span id="s1_goal_2">&rArr;</span>   writeln(<span id="s1_goal_route_A">Route&#x2081;</span>, ", total length ", <span id="s1_goal_len_A">Len&#x2081;</span>).
</span>
</pre>
<hr/>
<h4>DATABASE</h4>

<pre>
<span id="road_1">&rArr;</span> road(joensuu, kajaani, 230). % 230 km road connection from Joensuu to Kajaani
<span id="road_2">&rArr;</span> road(kajaani, oulu, 183). % 183 km road connection from Kajaani to Oulu


<span id="member_1">&rArr;</span> member(H, [H|_]).

<span id="member_2">&rArr;</span> member(X, [_|T]) :-
<span id="member_2_1">&rArr;</span>   member(X, T).
  
  
<span id="connected_1">&rArr;</span> connected(Town1, Town2, Length) :- 
<span id="connected_1_1">&rArr;</span>   road(Town1, Town2, Length). 

<span id="connected_2">&rArr;</span> connected(Town1, Town2, Length) :- 
<span id="connected_2_1">&rArr;</span>   road(Town2, Town1, Length). 


<span id="route_1">&rArr;</span> route(Town, Town, _, [Town], 0).

<span id="route_2">&rArr;</span> route(Town1, Town2, ToTown1, [Town1|FromTown1], Length) :- 
<span id="route_2_1">&rArr;</span>   ToTownX = [Town1|ToTown1],
<span id="route_2_2">&rArr;</span>   connected(Town1, TownX, Length1), 
<span id="route_2_3">&rArr;</span>   not(member(TownX, ToTownX)),   
<span id="route_2_4">&rArr;</span>   route(TownX, Town2, ToTownX, FromTown1, Length2), 
<span id="route_2_5">&rArr;</span>   Length = Length1 + Length2.
   
   
<span id="_goal_1">&rArr;</span> :- route(oulu, joensuu, [], Route, Len),
<span id="_goal_2">&rArr;</span>   writeln(Route, ", total length ", Len).




</pre>
</p>
</div>
<script>
<!--
var transitions = {
  "_init":{
    from:null, to:"start", assign:[],
    style:[
      {ids:["_goal_1"], from:"", to:""},
      {
        ids:[
          "road_1",
          "road_2",
          "member_1",
          "member_2",
          "member_2_1",
          "connected_1",
          "connected_1_1",
          "connected_2",
          "connected_2_1",
          "route_1",
          "route_2",
          "route_2_1",
          "route_2_2",
          "route_2_3",
          "route_2_4",
          "route_2_5",
          "_goal_2",
          "s1_goal_1",
          "s1_goal_1c",
          "s1_goal_2",
        ], 
        from:"", to:"visibility:hidden;"
      },
    ]
  },
  "_start_1":{
    from:"start", to:"s1", 
    assign:[
    ],
    style:[
      {ids:["_goal_1"], from:"", to:"visibility:hidden;"},
      {ids:["s1", "s1_goal_1", "co_s1"], from:"display:none;", to:""},
      {ids:["co_start"], from:"", to:"display:none;"},
    ]
  },
/*
  "_start_1":{
    from:"start", to:"s1", 
    assign:[
      {ids:["route_1_town1", "route_1_town1_0"], from:"Town1", to:"oulu"},
      {ids:["route_1_town2", "route_1_town2_0"], from:"Town2", to:"joensuu"},
      {ids:["route_1_length", "route_1_length_0"], from:"Length", to:"@Len"}
    ],
    style:[
      {ids:["_1_1"], from:"", to:"visibility:hidden;"},
      {ids:["_1_1c"], from:"visibility:hidden;", to:""},
      {ids:["route_1_1"], from:"visibility:hidden;", to:""},
    ]
  },
*/
  "t1":{
    from:"s1", to:"s2", 
    assign:[
    ],
    style:[
      {ids:["route_1_1"], from:"", to:"visibility:hidden;"},
      {ids:["route_1_2"], from:"visibility:hidden;", to:""},
    ]
  },
  "t2":{
    from:"s2", to:"s3", 
    assign:[
      {ids:["connected_1_town1", "connected_1_town1_0"], from:"Town1", to:"oulu"},
      {ids:["connected_1_town2", "connected_1_town2_0"], from:"Town2", to:"@TownX"},
      {ids:["connected_1_length", "connected_1_length_0"], from:"Length", to:"@Length1"},
    ],
    style:[
      {ids:["route_1_2"], from:"", to:"visibility:hidden;"},
      {ids:["connected_1_1"], from:"visibility:hidden;", to:""}, 
      {ids:["route_1_2c"], from:"visibility:hidden;", to:""},
    ]
  },
  "t3":{
    from:"s3", to:"s4", 
    assign:[
    ],
    style:[
      {ids:["connected_1_1"], from:"", to:"visibility:hidden;"},
      {ids:["connected_1_2"], from:"visibility:hidden;", to:""}, 
    ]
  },
  "t4":{
    from:"s4", to:"s5", 
    assign:[
      {ids:["connected_1_2x"], from:"", to:"<font color=\"#CC0000\"><b>FAIL!</b></font>"},
    ],
    style:[
    ]
  },
  "t5":{
    from:"s5", to:"s6",
    backtrack:["t4", "t3", "t2"],    
    assign:[
      {ids:["connected_2_town1", "connected_2_town1_0"], from:"Town1", to:"oulu"},
      {ids:["connected_2_town2", "connected_2_town2_0"], from:"Town2", to:"@TownX"},
      {ids:["connected_2_length", "connected_2_length_0"], from:"Length", to:"@Length1"},
    ],
    style:[
      {ids:["route_1_2"], from:"", to:"visibility:hidden;"},
      {ids:["connected_2_1"], from:"visibility:hidden;", to:""}, 
      {ids:["route_1_2c"], from:"visibility:hidden;", to:""},
    ]
  },
  "t6":{
    from:"s6", to:"s7", 
    assign:[
    ],
    style:[
      {ids:["connected_2_1"], from:"", to:"visibility:hidden;"},
      {ids:["connected_2_2"], from:"visibility:hidden;", to:""}, 
    ]
  },
  "t7":{
    from:"s7", to:"s8", 
    assign:[
      {ids:["connected_2_town2", "connected_2_town2_0"], from:"@TownX", to:"kajaani"},
      {ids:["connected_2_length", "connected_2_length_0"], from:"@Length1", to:"183"},
      {ids:["route_1_townx", "route_1_townx_0"], from:"TownX", to:"kajaani"},
      {ids:["route_1_length1", "route_1_length1_0"], from:"Length1", to:"183"},
      {ids:["road_2x"], from:"", to:"<font color=\"#008888\"><b>SUCCESS! </b></font>"},
    ],
    style:[
      {ids:["connected_2_2"], from:"", to:"visibility:hidden;"},
      {ids:["road_2", "connected_2_2c"], from:"visibility:hidden;", to:""}, 
    ]
  },
  "t8":{
    from:"s8", to:"s9", 
    assign:[
      {ids:["road_2x"], from:"<font color=\"#008888\"><b>SUCCESS! </b></font>", to:""},
      {ids:["connected_2_2x"], from:"", to:"<font color=\"#008888\"><b>SUCCESS! </b></font>"},
    ],
    style:[
      {ids:["connected_2_2"], from:"visibility:hidden;", to:""},
      {ids:["road_2", "connected_2_2c"], from:"", to:"visibility:hidden;"}, 
    ]
  },
  "t9":{
    from:"s9", to:"s10", 
    assign:[
      {ids:["connected_2_2x"], from:"<font color=\"#008888\"><b>SUCCESS! </b></font>", to:""},
    ],
    style:[
      {ids:["route_1_3"], from:"visibility:hidden;", to:""},
      {ids:["connected_2_2", "route_1_2c"], from:"", to:"visibility:hidden;"}, 
    ]
  },
  "t10":{
    from:"s10", to:"s11", 
    assign:[
      {ids:["s1_route_1_town1", "s1_route_1_town1_0"], from:"Town1", to:"kajaani"},
      {ids:["s1_route_1_town2", "s1_route_1_town2_0"], from:"Town2", to:"joensuu"},
      {ids:["s1_route_1_length", "s1_route_1_length_0"], from:"Length", to:"@Length2"}
    ],
    style:[
      {ids:["route_1_3"], from:"", to:"visibility:hidden;"},
      {ids:["route_1_3c"], from:"visibility:hidden;", to:""},
      {ids:["s1_route_1_1"], from:"visibility:hidden;", to:""},
      {ids:["s1"], from:"visibility:hidden;", to:""},
    ]
  },
  "t11":{
    from:"s11", to:"s12", 
    assign:[
    ],
    style:[
      {ids:["s1_route_1_1"], from:"", to:"visibility:hidden;"},
      {ids:["s1_route_1_2"], from:"visibility:hidden;", to:""},
    ]
  },
  "t12":{
    from:"s12", to:"s13", 
    assign:[
      {ids:["connected_1_town1", "connected_1_town1_0"], from:"Town1", to:"kajaani"},
      {ids:["connected_1_town2", "connected_1_town2_0"], from:"Town2", to:"@TownX"},
      {ids:["connected_1_length", "connected_1_length_0"], from:"Length", to:"@Length1"},
    ],
    style:[
      {ids:["s1_route_1_2"], from:"", to:"visibility:hidden;"},
      {ids:["connected_1_1"], from:"visibility:hidden;", to:""}, 
      {ids:["s1_route_1_2c"], from:"visibility:hidden;", to:""},
    ]
  },
  "t13":{
    from:"s13", to:"s14", 
    assign:[
    ],
    style:[
      {ids:["connected_1_1"], from:"", to:"visibility:hidden;"},
      {ids:["connected_1_2"], from:"visibility:hidden;", to:""}, 
    ]
  },
  "t14":{
    from:"s14", to:"s15", 
    assign:[
      {ids:["connected_1_town2", "connected_1_town2_0"], from:"@TownX", to:"oulu"},
      {ids:["connected_1_length", "connected_1_length_0"], from:"@Length1", to:"183"},
      {ids:["s1_route_1_townx", "s1_route_1_townx_0"], from:"TownX", to:"oulu"},
      {ids:["s1_route_1_length1", "s1_route_1_length1_0"], from:"Length1", to:"183"},
      {ids:["road_2x"], from:"", to:"<font color=\"#008888\"><b>SUCCESS! </b></font>"},
    ],
    style:[
      {ids:["connected_1_2"], from:"", to:"visibility:hidden;"},
      {ids:["road_2", "connected_1_2c"], from:"visibility:hidden;", to:""}, 
    ]
  }
/*

  "t14":{
    from:"s14", to:"s15", 
    assign:[
      {ids:["connected_1_2x"], from:"", to:"<font color=\"#CC0000\"><b>FAIL!</b></font>"},
    ],
    style:[
    ]
  }
  "t5":{
    from:"s5", to:"s6",    
    assign:[
      {ids:["connected_1_2x"], from:"", to:"<font color=\"#BB0000\"><b>FAIL!</b></font>"},
    ],
    style:[
    ]
  }
*/
};

var states = {
  "_init":{fw:"_init", bk:null},
  "start":{fw:"_start_1", bk:null},
  "s1":{fw:null, bk:"_start_1"},
  "s2":{fw:"t2", bk:"t1"},
  "s3":{fw:"t3", bk:"t2"},
  "s4":{fw:"t4", bk:"t3"},
  "s5":{fw:"t5", bk:"t4"},
  "s6":{fw:"t6", bk:"t5"},
  "s7":{fw:"t7", bk:"t6"},
  "s8":{fw:"t8", bk:"t7"},
  "s9":{fw:"t9", bk:"t8"},
  "s10":{fw:"t10", bk:"t9"},
  "s11":{fw:"t11", bk:"t10"},
  "s12":{fw:"t12", bk:"t11"},
  "s13":{fw:"t13", bk:"t12"},
  "s14":{fw:"t14", bk:"t13"},
  "s15":{fw:null, bk:"t14"},
};

var cur_state = "_init";

var variables = {
/*
          "road_1":null,
          "road_2":null,
          "member_1":null,
          "member_2":null,
          "member_2_1":null,
          "connected_1":null,
          "connected_1_1":null,
          "connected_2":null,
          "connected_2_1":null,
          "route_1":null,
          "route_2":null,
          "route_2_1":null,
          "route_2_2":null,
          "route_2_3":null,
          "route_2_4":null,
          "route_2_5":null,
          "_goal_1":null,
          "_goal_2":null,
          "s1":null,
          "s1_goal_1":null,
          "s1_goal_2":null,
*/
//  "":null,
}


function transit_fw(tr_id) {
  var transition = transitions[tr_id];
  var i, j, assign, style;
  
  if ("backtrack" in transition) {
    for(i = 0; i < transition.backtrack.length; i++) {
      transit_bw(transition.backtrack[i]);
    }
  }

  for (i = 0; i < transition.assign.length; i++) { // for all affected variables
    assign = transition.assign[i];
    for (j = 0; j < assign.ids.length; j++) {  // for all names of that variable
      variables[assign.ids[j]].innerHTML = assign.to;
    }
  }
    
  for (i = 0; i < transition.style.length; i++) { // for all affected variables
    style = transition.style[i];
    for (j = 0; j < style.ids.length; j++) {  // for all names of that variable
      variables[style.ids[j]].style.cssText = style.to;
    }
  }
}

function transit_bw(tr_id) {
  var transition = transitions[tr_id];
  var i, j, assign, style;
  
  for (i = 0; i < transition.assign.length; i++) { // for all affected variables
    assign = transition.assign[i];
    for (j = 0; j < assign.ids.length; j++) {  // for all names of that variable
      variables[assign.ids[j]].innerHTML = assign.from;
    }
  }
    
  for (i = 0; i < transition.style.length; i++) { // for all affected variables
    style = transition.style[i];
    for (j = 0; j < style.ids.length; j++) {  // for all names of that variable
      variables[style.ids[j]].style.cssText = style.from;
    }
  }

  if ("backtrack" in transition) {
    for(i = transition.backtrack.length - 1; i >= 0; i--) {
      transit_fw(transition.backtrack[i]);
    }
  }
}










function forwards() {
  var state = states[cur_state];
  if (!state.fw) return;
  var transition = transitions[state.fw];
  var i, j, assign, style;
  
  transit_fw(state.fw);
  
  if(transition.to) cur_state = transition.to; // finally, change current state
}

function backwards() {
  var state = states[cur_state];
  if (!state.bk) return;
  var transition = transitions[state.bk];
  var i, j, assign;

  transit_bw(state.bk);
  
  
  if (transition.from) cur_state = transition.from; // finally, change current state
}

// Initialize

var id;
var trans_id, i, j, ids;
var cur_trans;

for (trans_id in transitions) {
  if (transitions.hasOwnProperty(trans_id)) {
    cur_trans = transitions[trans_id];
    if ("style" in cur_trans) {
      for (i = 0; i < cur_trans.style.length; i++) {
        ids = cur_trans.style[i].ids;
        for (j = 0; j < ids.length; j++) {
          if (!(ids[j] in variables)) {
            variables[ids[j]] = null;
          }
        }
      }
    }
    if ("assign" in cur_trans) {
      for (i = 0; i < cur_trans.assign.length; i++) {
        ids = cur_trans.assign[i].ids;
        for (j = 0; j < ids.length; j++) {
          if (!(ids[j] in variables)) {
            variables[ids[j]] = null;
          }
        }
      }
    }
  }
}

for (id in variables) {
  if (variables.hasOwnProperty(id)) {
    variables[id] = document.getElementById(id);
  }
  
}  
state = "_init";
forwards();

// -->
</script>
</body>
</html>